


TROUBLESHOOT AG

SELECT 
    ag.name AS AvailabilityGroupName,
    ar.replica_server_name AS ReplicaName,
    rs.role_desc AS ReplicaRole
FROM 
    sys.availability_replicas ar
JOIN 
    sys.dm_hadr_availability_replica_states rs
ON 
    ar.replica_id = rs.replica_id
JOIN 
    sys.availability_groups ag
ON 
    rs.group_id = ag.group_id;


SELECT 
    ag.name AS AvailabilityGroupName,
    ag.ag_states_desc AS AGState,
    ag.is_online
FROM 
    sys.availability_groups ag;


SELECT * 
FROM sys.server_permissions
WHERE grantee_principal_id = USER_ID('YourLoginName')
AND permission_name = 'ALTER ANY AVAILABILITY GROUP';


SELECT pr.name, dp.permission_name, dp.state_desc
FROM sys.availability_groups ag
JOIN sys.database_permissions dp 
ON ag.group_id = dp.major_id
JOIN sys.database_principals pr 
ON dp.grantee_principal_id = pr.principal_id
WHERE ag.name = 'YourAGName';


SELECT * 
FROM fn_my_permissions('YourDatabaseName', 'DATABASE')
WHERE permission_name IN ('ALTER', 'TAKE OWNERSHIP');


GRANT ALTER ANY AVAILABILITY GROUP TO [YourLoginName];

GRANT CONTROL ON AVAILABILITY GROUP::[YourAGName] TO [YourLoginName];

